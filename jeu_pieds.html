<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Devine pieds - Satureja path</title>


<style>
  body {
    font-family: sans-serif;
    text-align: center;
    margin: 0;
    padding: 20px;
    position: relative;
    
  }

  .container-haut, .container-bas {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 20px 0;
  }
  .container-bas {
    margin-top: 100px;
  }

  .item {
    position: relative;
    display: inline-block;
  }

  .portrait img {
    width: 150px;
    height: auto;
    border-radius: 0px;
  }

  .point {
    position: absolute;
    left: 50%;
    width: 20px;
    height: 20px;
    border: 2px solid #ccc;
    border-radius: 30%;
    background-color: white;
    cursor: pointer;
    transform: translateX(-50%);
  }

  /* Points en haut (personnes) */
#persons .point {
  top: 80%;
  bottom: auto; /* pour annuler bottom */
  left: 50%;
  transform: translateX(-50%);
}

/* Points en bas (pieds) */
#objects .point {
  bottom: 100%;
  top: auto; /* pour annuler top */
  left: 50%;
  transform: translateX(-50%);
}

  .button-text {
    background-color: blue;
    color: white;
    padding: 8px 15px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 16px;
  }

  h1 {
    margin-bottom: 30px;
  }

  /* Taille maximale pour les photos de pieds */
#objects .portrait img {
  max-width: 150px;
  max-height: 150px;
  object-fit: contain; /* Pour que l'image garde ses proportions */
}
#objects .portrait img:hover {
  transform: scale(1.2);
  transition: transform 0.3s ease;
  z-index: 10;
  position: relative;
  border-radius: 0 !important;
}

@keyframes popfail {
  0% { transform: translate(-50%, -50%) scale(0.5); }
  20% { transform: translate(-50%, -50%) scale(2.5); }
  50% { transform: translate(-50%, -50%) scale(1.6); }
  70% { transform: translate(-50%, -50%) scale(2.1); }
  100% { transform: translate(-50%, -50%) scale(2); } /* reste à ×2 */
}

@keyframes popwin {
  0% { transform: translate(-50%, -50%) scale(1.5); }
  20% { transform: translate(-50%, -50%) scale(3.5); }
  50% { transform: translate(-50%, -50%) scale(2.6); }
  70% { transform: translate(-50%, -50%) scale(3.1); }
  100% { transform: translate(-50%, -50%) scale(3); } /* reste à ×3 */
}

.showPopfail {
  animation: popfail 0.8s ease-in-out forwards;
}

.showPopwin {
  animation: popwin 0.8s ease-in-out forwards;
}



</style>
<meta charset="utf-8">
        <title>messyflowerzz - Satureja path</title> 
        <link rel="stylesheet" href="style.css">
        <link rel="icon" href="images/favicon.ico" type="image/x-icon">
        <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ballet:opsz@16..72&family=Jacquarda+Bastarda+9&family=Rubik:ital,wght@0,300..900;1,300..900&family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="menu-container"></div>

<!-- animation si fail -->
<audio id="failSound" src="sounds/fart.mp3" preload="auto"></audio>
<img id="failImage" src="images/pieds_crop/smiley_pied_qui_pue.jpeg" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%) scale(2); z-index:999; max-width:400px;">

<!-- animation si win -->
<audio id="winSound" src="sounds/fanfare.mp3" preload="auto"></audio>
<img id="winImage" src="images/pieds_crop/emoji-feet-3480078374.gif" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%) scale(3); z-index:999; max-width:500px;">

<h1>Relie les pieds à leur propriétaire</h1>

<div class="container-haut" id="persons"></div>

<!-- SVG pour tracer les lignes -->
<svg id="lines" style="position:absolute; top:0; left:0; pointer-events:none;"></svg>

<div class="container-bas" id="objects"></div>

<h3 id="score"></h3>

<div style="margin: 20px;">
  <button id="check" class="button-text">Vérifier</button>
  <button onclick="location.reload()" class="button-text">Recommencer</button>
</div>

<script>
// Données : portraits + plusieurs images pieds par personne
const personsData = {
  Kevin: {
    portrait: 'images/portraits/kevin.jpg',
    feet: [
      'images/pieds_crop/Kevin/Image1.webp',
      'images/pieds_crop/Kevin/Image2.webp',
      'images/pieds_crop/Kevin/Image3.webp'
    ]
  },
  Bullefesse: {
    portrait: 'images/portraits/bullefesse.jpg',
    feet: [
      'images/pieds_crop/Aloyse/IMG_1971.webp',
      'images/pieds_crop/Aloyse/IMG_1994.webp',
      'images/pieds_crop/Aloyse/IMG_2025.webp',
      'images/pieds_crop/Aloyse/IMG_2029.webp',
      'images/pieds_crop/Aloyse/IMG_2032.webp',
      'images/pieds_crop/Aloyse/IMG_2033.webp',
      'images/pieds_crop/Aloyse/IMG_2089.webp',
      'images/pieds_crop/Aloyse/IMG_2090.webp'
    ]
  },
  Cyril: {
    portrait: 'images/portraits/cyril.jpg',
    feet: [
      'images/pieds_crop/Cyril/IMG_0614.webp',
      'images/pieds_crop/Cyril/IMG_0872.webp',
      'images/pieds_crop/Cyril/IMG_0615.webp'
    ]
  },
  Hippo: {
    portrait: 'images/portraits/hippo.jpg',
    feet: [
      'images/pieds_crop/Hippo/Image1.webp',
      'images/pieds_crop/Hippo/Image2.webp',
      'images/pieds_crop/Hippo/Image3.webp',
      'images/pieds_crop/Hippo/Image4.webp',
      'images/pieds_crop/Hippo/Image5.webp',
      'images/pieds_crop/Hippo/Image6.webp',
      'images/pieds_crop/Hippo/Image7.webp',
      'images/pieds_crop/Hippo/Image8.webp',
      'images/pieds_crop/Hippo/Image9.webp',
      'images/pieds_crop/Hippo/Image10.webp',
      'images/pieds_crop/Hippo/Image11.webp',
      'images/pieds_crop/Hippo/Image12.webp',
      'images/pieds_crop/Hippo/Image13.webp',
      'images/pieds_crop/Hippo/Image14.webp'

    ]
  },
  Hugo: {
    portrait: 'images/portraits/hugot.jpg',
    feet: [
      'images/pieds_crop/Hugot/Image1.webp',
      'images/pieds_crop/Hugot/Image2.webp',
      'images/pieds_crop/Hugot/Image3.webp'
    ]
  },
  Jasmine: {
    portrait: 'images/portraits/jasmine.jpg',
    feet: [
      'images/pieds_crop/Jasmine/Image1.webp',
      'images/pieds_crop/Jasmine/Image2.webp',
      'images/pieds_crop/Jasmine/Image3.webp'
    ]
  },
   Emma: {
    portrait: 'images/portraits/emma.webp',
    feet: [
      'images/pieds_crop/Emma/Image1.webp',
      'images/pieds_crop/Emma/Image2.webp',
      'images/pieds_crop/Emma/Image3.webp',
      'images/pieds_crop/Emma/Image4.webp',
      'images/pieds_crop/Emma/Image5.webp'
    ]
  },
  Laura: {
    portrait: 'images/portraits/laura.jpg',
    feet: [
      'images/pieds_crop/Laura/Image1.webp',
      'images/pieds_crop/Laura/Image2.webp',
      'images/pieds_crop/Laura/Image3.webp'
    ]
  },
  Laureu: {
    portrait: 'images/portraits/laureu.jpg',
    feet: [
      'images/pieds_crop/Laureu/Image1.webp',
      'images/pieds_crop/Laureu/Image2.webp',
      'images/pieds_crop/Laureu/Image3.webp',
      'images/pieds_crop/Laureu/Image4.webp',
      'images/pieds_crop/Laureu/Image5.webp',
      'images/pieds_crop/Laureu/Image6.webp'
    ]
  },
  Louise: {
    portrait: 'images/portraits/louise.jpg',
    feet: [
      'images/pieds_crop/Louise/Image1.webp',
      'images/pieds_crop/Louise/Image2.webp',
      'images/pieds_crop/Louise/Image3.webp'
    ]
  },
  Lucile: {
    portrait: 'images/portraits/Lucile.jpg',
    feet: [
      'images/pieds_crop/Lucile/Image1.webp',
      'images/pieds_crop/Lucile/Image2.webp',
      'images/pieds_crop/Lucile/Image3.webp'
    ]
  },
  Malol: {
    portrait: 'images/portraits/malol.jpg',
    feet: [
      'images/pieds_crop/Malol/Image1.webp',
      'images/pieds_crop/Malol/Image2.webp',
      'images/pieds_crop/Malol/Image3.webp',
      'images/pieds_crop/Malol/Image4.webp'
    ]
  },
  Mateo: {
    portrait: 'images/portraits/mateo.jpg',
    feet: [
      'images/pieds_crop/Mateo/Image1.webp',
      'images/pieds_crop/Mateo/Image2.webp',
      'images/pieds_crop/Mateo/Image3.webp'
    ]
  },
  Maxime: {
    portrait: 'images/portraits/maxime.jpg',
    feet: [
      'images/pieds_crop/Maxime/Image1.webp',
      'images/pieds_crop/Maxime/Image2.webp',
      'images/pieds_crop/Maxime/Image3.webp',
      'images/pieds_crop/Maxime/Image4.webp',
      'images/pieds_crop/Maxime/Image5.webp',
      'images/pieds_crop/Maxime/Image6.webp',
      'images/pieds_crop/Maxime/Image7.webp',
      'images/pieds_crop/Maxime/Image8.webp'
    ]
  },
  Raph: {
    portrait: 'images/portraits/raph.jpg',
    feet: [
      'images/pieds_crop/Raph/Image1.webp',
      'images/pieds_crop/Raph/Image2.webp',
      'images/pieds_crop/Raph/Image3.webp',
      'images/pieds_crop/Raph/Image4.webp',
      'images/pieds_crop/Raph/Image5.webp'
    ]
  },
  Salome: {
    portrait: 'images/portraits/salome.webp',
    feet: [
      'images/pieds_crop/Salome/Image1.webp',
      'images/pieds_crop/Salome/Image2.webp',
      'images/pieds_crop/Salome/Image3.webp'
    ]
  },
   Titouan: {
    portrait: 'images/portraits/titouan.jpg',
    feet: [
      'images/pieds_crop/Titouan/Image1.webp',
      'images/pieds_crop/Titouan/Image2.webp',
      'images/pieds_crop/Titouan/Image3.webp'
    ]
  },
   Yann: {
    portrait: 'images/portraits/yann.jpg',
    feet: [
      'images/pieds_crop/Yann/Image1.webp',
      'images/pieds_crop/Yann/Image2.webp',
      'images/pieds_crop/Yann/Image3.webp',
      'images/pieds_crop/Yann/Image4.webp',
      'images/pieds_crop/Yann/Image5.webp'
    ]
  },
   Ylo: {
    portrait: 'images/portraits/ylo.webp',
    feet: [
      'images/pieds_crop/Ylo/Image1.webp',
      'images/pieds_crop/Ylo/Image2.webp',
      'images/pieds_crop/Ylo/Image3.webp'
    ]
  }
};

// Tirer un élément aléatoire d'un tableau
function randomChoice(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

// Tirer N personnes aléatoires
function getRandomPersons(data, count = 5) {
  const keys = Object.keys(data);
  const shuffled = keys.sort(() => 0.5 - Math.random());
  return shuffled.slice(0, count);
}

// Conteneurs HTML
const personsContainer = document.getElementById('persons');
const objectsContainer = document.getElementById('objects');
const svg = document.getElementById('lines');
const scoreEl = document.getElementById('score');

let selectedPoint = null;
let connections = [];

const selectedPersons = getRandomPersons(personsData, 5);

const correctPairs = {}; // Pour vérifier

// Générer le HTML des personnes et pieds
function initGame() {
  personsContainer.innerHTML = '';
  objectsContainer.innerHTML = '';
  connections = [];
  selectedPoint = null;
  scoreEl.textContent = '';

  // Afficher les personnes en haut (dans l'ordre sélectionné)
  selectedPersons.forEach(name => {
    const person = personsData[name];

    const personDiv = document.createElement('div');
    personDiv.className = 'item';
    personDiv.innerHTML = `
      <div class="portrait"><img src="${person.portrait}" alt="${name}"></div>
      <div class="point" data-id="${name}"></div>
    `;
    personsContainer.appendChild(personDiv);
  });

  // Construire un tableau des pieds avec leur propriétaire
  const feetItems = selectedPersons.map(name => {
    const person = personsData[name];
    const randomFeet = randomChoice(person.feet);
    return {
      owner: name,
      feetSrc: randomFeet
    };
  });

  // Mélanger ce tableau de pieds
  feetItems.sort(() => 0.5 - Math.random());

  // Afficher les pieds dans l’ordre mélangé
  feetItems.forEach(item => {
    const feetDiv = document.createElement('div');
    feetDiv.className = 'item';
    feetDiv.innerHTML = `
      <div class="point" data-id="f-${item.owner.toLowerCase()}"></div>
      <div class="portrait"><img src="${item.feetSrc}" alt="Pieds de ${item.owner}"></div>
    `;
    objectsContainer.appendChild(feetDiv);

    // Mise à jour correctPairs si besoin (normalement déjà ok)
    correctPairs[item.owner] = 'f-' + item.owner.toLowerCase();
  });

  setupClicks();
  drawConnections();
}


// Calculer centre d’un élément (pour dessiner la ligne)
function getPointCenter(el) {
  const rect = el.getBoundingClientRect();
  return {
    x: rect.left + rect.width / 2 + window.scrollX,
    y: rect.top + rect.height / 2 + window.scrollY
  };
}

// Dessiner les connexions (lignes SVG)
function drawConnections(checking = false) {
  svg.innerHTML = '';
  svg.setAttribute('width', document.body.scrollWidth);
  svg.setAttribute('height', document.body.scrollHeight);

  connections.forEach(conn => {
    const p1 = getPointCenter(conn.from);
    const p2 = getPointCenter(conn.to);
    const dx = (p2.x - p1.x) / 2;
    const pathData = `M${p1.x},${p1.y} C${p1.x + dx},${p1.y} ${p2.x - dx},${p2.y} ${p2.x},${p2.y}`;
    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    path.setAttribute('d', pathData);
    path.setAttribute('stroke-width', 3);
    path.setAttribute('fill', 'none');

    if (checking) {
  const fromId = conn.from.dataset.id;
  const toId = conn.to.dataset.id;

  // Normaliser pour que l’ordre n’impacte pas la validation
  let personId, footId;

  if (fromId.startsWith('f-')) {
    footId = fromId;
    personId = toId;
  } else {
    personId = fromId;
    footId = toId;
  }

  path.setAttribute('stroke', correctPairs[personId] === footId ? 'green' : 'red');
} else {
  path.setAttribute('stroke', 'blue');
}

    svg.appendChild(path);
  });
}

let tempPath = null;

function setupClicks() {
  // Supprimer anciens handlers si besoin
  document.querySelectorAll('.point').forEach(point => {
    point.style.outline = 'none';
    point.onclick = null;
  });

  document.querySelectorAll('.point').forEach(point => {
    point.addEventListener('click', () => {
      if (!selectedPoint) {
        selectedPoint = point;
        point.style.outline = '3px solid green';

        // Créer path temporaire
        const start = getPointCenter(selectedPoint);
        tempPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        tempPath.setAttribute('stroke', 'blue');
        tempPath.setAttribute('stroke-width', 3);
        tempPath.setAttribute('fill', 'none');
        svg.appendChild(tempPath);

        window.addEventListener('mousemove', followMouse);
      } else {
        // On ne relie que point du haut avec point du bas
        if (selectedPoint.closest('#persons') !== point.closest('#persons') && selectedPoint !== point) {
          // Vérifier qu’on ne relie pas 2 fois un même point (optional)
          const alreadyFrom = connections.some(c => c.from === selectedPoint);
          const alreadyTo = connections.some(c => c.to === point);

          if (!alreadyFrom && !alreadyTo) {
            connections.push({ from: selectedPoint, to: point });
          } else {
            // Si déjà relié, on peut prévenir ou juste remplacer la connexion (optionnel)
          }
          selectedPoint.style.outline = 'none';
          selectedPoint = null;
          drawConnections();
        } else {
          // Cliqué sur même type point => reset sélection
          selectedPoint.style.outline = 'none';
          selectedPoint = null;
          if (tempPath) {
            svg.removeChild(tempPath);
            tempPath = null;
          }
          window.removeEventListener('mousemove', followMouse);
          return;
        }

        // Supprimer path temporaire
        if (tempPath) {
          svg.removeChild(tempPath);
          tempPath = null;
        }
        window.removeEventListener('mousemove', followMouse);
      }
    });
  });
}

function followMouse(e) {
  if (!tempPath || !selectedPoint) return;
  const p1 = getPointCenter(selectedPoint);
  const p2 = { x: e.pageX, y: e.pageY };
  const dx = (p2.x - p1.x) / 2;
  const pathData = `M${p1.x},${p1.y} C${p1.x + dx},${p1.y} ${p2.x - dx},${p2.y} ${p2.x},${p2.y}`;
  tempPath.setAttribute('d', pathData);
}

// Vérification du score et animations en conséquence
document.getElementById('check').addEventListener('click', () => {
  let score = 0;
  const failSound = document.getElementById('failSound');
  const failImage = document.getElementById('failImage');

  connections.forEach(conn => {
    let fromId = conn.from.dataset.id;
    let toId = conn.to.dataset.id;
    if (fromId.startsWith('f-')) [fromId, toId] = [toId, fromId];
    if (correctPairs[fromId] === toId) score++;
  });

  drawConnections(true);
  scoreEl.textContent = `Score : ${score} / ${Object.keys(correctPairs).length}`;

  // OUPS RATE
  if (score < 5) {
    // Joue le son
    failSound.currentTime = 0;
    failSound.play();

    // DELAI DE L'IMAGE POUR ETRE SYNCRHO AVEC LE PROUT
    setTimeout(() => {
      failImage.style.display = 'block';
      failImage.classList.add('showPopfail');
    
      // Retire l’animation pour la rejouer plus tard
      setTimeout(() => failImage.classList.remove('showPopfail'), 800);
    
      // Cache l'image après 3 secondes
      setTimeout(() => {
        failImage.style.display = 'none';
      }, 3000);
    }, 1000); // <-- délai avant l'image

    // Affiche l'image SANS DELAI DONC PAS SYNCHRO AVEC LE PROUT
    //failImage.style.display = 'block';
    //failImage.classList.add('showPopfail');

    // Retire l’animation pour la rejouer plus tard
    //setTimeout(() => failImage.classList.remove('showPopfail'), 800);

    // Cache l'image après 3 secondes
    //setTimeout(() => {
    //  failImage.style.display = 'none';
    //}, 3000);
  }

  //BIEN JOUÉ!!
  if (score === 5) {
    // Joue le son
    winSound.currentTime = 0;
    winSound.play();

    // DELAI DE L'IMAGE POUR ETRE SYNCRHO
    setTimeout(() => {
      winImage.style.display = 'block';
      winImage.classList.add('showPopwin');
    
      // Retire l’animation pour la rejouer plus tard
      setTimeout(() => winImage.classList.remove('showPopwin'), 800);
    
      // Cache l'image après 3 secondes
      setTimeout(() => {
        winImage.style.display = 'none';
      }, 3600);
    }, 1000); // <-- délai avant l'image

    // Affiche l'image SANS DELAI DONC PAS SYNCHRO
    //winImage.style.display = 'block';
    //winImage.classList.add('showPopwin');

    // Retire l’animation pour la rejouer plus tard
    //setTimeout(() => winImage.classList.remove('showPopwin'), 800);

    // Cache l'image après 3 secondes
    //setTimeout(() => {
    //  winImage.style.display = 'none';
    //}, 3000);
  }
});


// Recalculer lignes au scroll / resize
window.addEventListener('scroll', () => drawConnections());
window.addEventListener('resize', () => drawConnections());

// Lancer le jeu
initGame();
</script>

</body>
</html>